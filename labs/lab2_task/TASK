Лабораторная работа 2
1. Результат выполнения лабораторных работ — это три сценария на языке командного
интерпретатора.:
первый (основной) выполняет задание;
второй (тестовый) проверяет правильность работы основного;
третий (обнуляющий) возвращает систему в исходное состояние так, чтобы можно
было запустить процесс выполнения сценариев сначала.
2. Задача основного сценария второй лабораторной работы:
создать в /tmp в новом файле my_sys_2M.img размером 2M файловую систему ext2;
провести монтирование новой ФС в /mnt/new_disk;
исследовать возможность заполнения ФС в двух вариантах:
по количеству файлов;
по объёму ФС (дополнительное самостоятельное задание);
3. Тестовый сценарий должен проверить наличие ФС, показать её параметры,
количество созданных файлов.
4. Для возврата к начальным условиям необходимо очистить и отмонтировать файловую
систему, а затем удалить файл my_sys_2M.img .
5. Для начала работы запустите текстовый редактор nano:
nano base2.sh
6. Наберите шебанг и первые комментарии с описанием сценария:
#!/bin/sh
# сценарий создания и монтирования ФС
# лабораторная работа № 2
Дальше следуют команды подготовки файла my_sys_2M.img и создания на нем ФС:
truncate -s 2M /tmp/my_sys_2M.img
# файл заданного размера
mkfs.ext2 /tmp/my_sys_2M.img
# созд. ФС ext2
mkdir /mnt/new_disk
# созд.точку монтирования
mount /tmp/my_sys_2M.img /mnt/new_disk
df -H /mnt/new_disk
# монтируем ФС
# выводим сведения о ФС
Теперь приступаем к заполнению ФС:
mkdir /mnt/new_disk/new_dir
# создаем каталог в новой ФС
# в новом каталоге: сколько влезет файлов,прячем сообщения об
ошибках
cd /mnt/new_disk/new_dir
i=1; while touch file_$i; do echo file_$i; i=$[i+1];done
(Предложите альтернативный вариант цикла, например с использованием for.)
7. Сохраните файл и закройте редактор. Настройте права на исполнение и запустите
сценарий с правами суперпользователя. После выполнения не забудьте завершить
сеанс работы суперпользователя.
chmod +x ./base2.sh
su -
cd <dir>*
./base2.sh
* - вернуться в каталог где создавали скрипт
8. Начните работу с тестовым сценарием:
nano test2.sh
9. Наберите шебанг и первые комментарии с описанием сценария:
#! /bin/sh
# сценарий исследования ФС
# лабораторная работа № 2
10. Тестовый сценарий должен вывести информацию о файловой системе и посчитать
количество файлов в созданном каталоге:
df -i /mnt/new_disk
# выводим сведения о количестве I-нодов
cd /mnt/new_disk/new_dir
echo "количество созданных файлов:"
ls -l | wc -l
# считаем количество файлов
11. Сохраните файл и закройте редактор. Настройте права на исполнение и запустите
сценарий.
chmod +x ./test2.sh
./test2.sh
12. Начните работу с обнуляющим сценарием:
nano reset2.sh
13. Наберите шебанг и первые комментарии с описанием сценария:
#!/bin/sh
# сценарий удаления ФС
# лабораторная работа № 2
14. Для возврата в исходное состояние нужно удалить созданные на новой ФС файлы и
каталоги, размонтировать её, удалить файл самой системы и каталог в /mnt. Часть
этих операций потребует прав суперпользователя:
cd /mnt/new_disk/
rm -rf *
umount /mnt/new_disk
rm /tmp/my_sys_2M.img
# переходим в ФС
# удаляем файлы
# размонтируем ФС
# удаляем файл my_sys_2M.img
rmdir /mnt/new_disk
Скрипт не отработал. Почему?
15. Сохраните файл и закройте редактор. Настройте права на исполнение и запустите
сценарий и запустите сценарий с правами суперпользователя. После выполнения не
забудьте завершить сеанс работы суперпользователя. .
chmod +x ./reset2.sh
su -
./reset2.sh
Задание 2.2
В качестве самостоятельного задания разработайте три аналогичных сценария, но исследуйте
переполнение файловой системы по объёму.
