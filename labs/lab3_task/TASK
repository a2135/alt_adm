Лабораторная работа 3
1. Как обычно, результат выполнения лабораторной работы — это три сценария на
языке командного интерпретатора.:
первый (основной) выполняет задание;
второй (тестовый) проверяет правильность работы основного;
третий (обнуляющий) возвращает систему в исходное состояние так,
чтобы можно было запустить процесс выполнения сценариев сначала.
2. Задача основного сценария третей лабораторной работы:
завести две локальные групповые учётные записи: group1 и group2;
создать три локальные пользовательские учётные записи: user1, user2, user3;
включить пользователей в группы следующим образом:
первый пользователь входит только в первую группу,
второй пользователь — в первую и вторую группы,
третий — только во вторую;
создать в пределах ветки дерева каталогов /srv каталоги dir1 и dir2;
разграничить права следующим образом:
подкаталог dir1 доступен на запись только группе group1,
dir2 — только группе group2.
3. Тестовый сценарий должен проверить соответствие прав на файлы, создаваемые в
каталогах dir1 и dir2.
4. Для возврата к начальным условиям необходимо удалить пользователей и группы, а
затем удалить созданные каталоги и файлы.
5. Для начала работы запустите текстовый редактор nano:
nano base3.sh
6.Наберите шебанг и первые комментарии с описанием
сценария:
#!/bin/sh
# сценарий создания групп пользователей
# лабораторная работа № 3
# Дальше следуют команды создания групп и пользователей:
groupadd group1
# создаем группы
groupadd group2
adduser user1
adduser user2
# новые пользователи
adduser user3
gpasswd -a user1 group1
# добавляем пользователей в группы
gpasswd -a user2 group1
gpasswd -a user2 group2
gpasswd -a user3 group2
for i in `seq 1 3` do
# инфо о пользователях и группах
echo "пользователь user$i"
id user$i
done
mkdir /srv/dir1 /srv/dir2
chgrp group1 dir1
# создаем каталоги
# "отдаем" каталоги соотв. группам
chgrp group2 dir2
chmod 2775
/srv/dir1 /srv/dir2
# права на запись в каталоги
ls -la /srv
7. Сохраните файл и закройте редактор. Настройте права на исполнение и запустите
сценарий и запустите сценарий с правами суперпользователя. После выполнения не
забудьте завершить сеанс работы суперпользователя.
8. Разработайте тестовый сценарий (обратите внимание на различные варианты
использования команды echo):
nano test3.sh
#!/bin/sh
# сценарий проверки прав пользователей
# лабораторная работа № 3
# USER2
su -l user2 -c '
cd /srv/dir1
touch file_u2d1
whoami && echo "создал(а) файл в каталоге" && pwd
cd /srv/dir2
touch file_u2d2
echo "`whoami` создал(а) файл в каталоге `pwd`"
# USER1
'
su -l user1 -c
'
# user1 - доступ к файлам в dir1
cd /srv/dir1/
whoami && echo "доступ к файлу в каталоге" && pwd
cp file_u2d1 file_u1d1
echo $?
# user1 - доступ к файлам в dir2
cd /srv/dir2/
echo "`whoami` создал(а) файл в каталоге `pwd`"
cp file_u2d2 file_u1d2
echo $?
'
9. Аналогично — для пользователя user3.
Затем сохраните файл и закройте редактор. Настройте права на исполнение и
запустите сценарий.
10.Разработайте обнуляющий сценарий:
nano reset3.sh
#!/bin/sh
# сценарий удаления файлов, групп и пользователей
# лабораторная работа № 3
# удаление каталогов и файлов
rm -rf /srv/dir1 /srv/dir2
# удаление групп и пользователей
userdel -r user1
userdel -r user2
userdel -r user3
groupdel group1
groupdel group2
11. Сохраните файл и закройте редактор. Настройте права на исполнение и запустите
сценарий и запустите сценарий с правами суперпользователя. После выполнения не
забудьте завершить сеанс работы суперпользователя.
Задание 3.2
В качестве самостоятельного задания разработайте три аналогичных сценария, при этом
имена пользователей и названия групп должны задаваться как параметры сценария. Должна
проводиться проверка количества передаваемых параметров.
